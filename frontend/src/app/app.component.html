<div class="container">
  <h1>{{ title }}</h1>

  <!-- Health -->
  <div class="card">
    <strong>Health:</strong>
    <span class="badge" *ngIf="health() as h">
      {{ h.status }} · {{ h.env }}
    </span>
  </div>

  <!-- Resumen básico -->
  <div class="card" *ngIf="stats() as s">
    <h3>Resumen</h3>
    <p>
      Total: <strong>{{ s.total }}</strong>
      · Pendientes: <strong>{{ s.pending }}</strong>
      · Hechas: <strong>{{ s.done }}</strong>
    </p>
  </div>

  <!-- Resumen avanzado calculado en el frontend -->
  <div class="card" *ngIf="advancedStats() as adv">
    <h3>Resumen avanzado</h3>
    <p>
      Con descripción: <strong>{{ adv.with_description }}</strong>
      · Sin descripción: <strong>{{ adv.without_description }}</strong><br />
      Títulos cortos: <strong>{{ adv.title_short }}</strong>
      · medianos: <strong>{{ adv.title_medium }}</strong>
      · largos: <strong>{{ adv.title_long }}</strong>
    </p>
  </div>

  <!-- Filtros -->
  <div class="card">
    <h3>Filtros</h3>
    <div class="form-row">
      <label>
        Texto:
        <input
          type="text"
          [(ngModel)]="filterText"
          placeholder="Buscar por título o descripción"
        />
      </label>
    </div>
    <div class="form-row">
      <label>
        Estado:
        <select [(ngModel)]="filterDone">
          <option value="all">Todos</option>
          <option value="pending">Pendientes</option>
          <option value="done">Hechos</option>
        </select>
      </label>
    </div>
    <div class="form-row">
      <button (click)="applyFilters()" [disabled]="loading()">
        Aplicar filtros
      </button>
    </div>
  </div>

  <!-- Errores -->
  <div class="card error" *ngIf="error">
    <strong>Error:</strong> {{ error }}
  </div>

  <!-- Todos -->
  <div class="card">
    <h3>Todos</h3>

    <!-- Formulario de alta -->
    <div class="form-row">
      <input
        type="text"
        [(ngModel)]="newTitle"
        placeholder="Nueva tarea..."
        data-testid="new-todo-title"
      />
    </div>

    <div class="form-row">
      <textarea
        [(ngModel)]="newDescription"
        placeholder="Descripción (opcional)"
        rows="3"
        data-testid="new-todo-description"
      ></textarea>
    </div>

    <div class="form-row">
      <button
        (click)="add()"
        [disabled]="loading()"
        data-testid="add-todo-button"
      >
        Agregar
      </button>
    </div>

    <!-- Lista -->
    <ul>
      <li *ngFor="let t of todos()">
        <span *ngIf="t.done">✔️</span>
        <span *ngIf="!t.done">⏳</span>

        <div class="todo-text">
          <div class="todo-title">{{ t.title }}</div>
          <div class="todo-description" *ngIf="t.description">
            {{ t.description }}
          </div>
        </div>

        <button (click)="toggle(t)" [disabled]="loading()">
          {{ t.done ? 'Marcar como pendiente' : 'Marcar como hecha' }}
        </button>
      </li>
    </ul>
  </div>
</div>
